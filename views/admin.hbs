<div id="data" style="display: none">
    {{result}}
</div>
<tr>
    <th >Delta(D will be added or subtracted from the userchoices )</th>
    <p></p>
    <td>
        <input type="text" name="delta" id="delta" placeholder="">

    </td>

</tr>
<p></p>

<table>

    <tr>
        <th>Choose polygons</th>
        <th>Proportion</th>
        <th>User choices</th>


    </tr>
    <tr>
        <td>pentagon</td>
        <td>
            <input type="checkbox" name="pentagon" id="pentagon" class="choice">
            <input type="text" name="proportion_pentagon" id="proportion_pentagon" class="proportion">
            <label for="cb1"><i class="toggle"></i></label>


        </td>
        <td>
            <input type="checkbox" name="pentagon_c" id="pentagon_c" class="userchoice">

        </td>
    </tr>
    <tr>
        <td>hexagon</td>
        <td>
            <input type="checkbox" name="hexagon" id="hexagon" class="choice">
            <input type="text" name="proportion_hexagon" id="proportion_hexagon" class="proportion">

            <label for="cb2"><i class="toggle"></i></label>

        </td>
        <td>
            <input type="checkbox" name="hexagon_c" id="hexagon_c" class="userchoice">

        </td>
    </tr>
    <tr>
        <td>heptagon</td>
        <td>
            <input type="checkbox" name="heptagon" id="heptagon" class="choice">
            <input type="text" name="proportion_heptagon" id="proportion_heptagon" class="proportion">

            <label for="cb3"><i class="toggle"></i></label>

        </td>
        <td>
            <input type="checkbox" name="heptagon_c" id="heptagon_c" class="userchoice">

        </td>
    </tr>
    <tr>
        <td>octagon</td>
        <td>
            <input type="checkbox" name="octagon" id="octagon" class="choice">
            <input type="text" name="proportion_" id="proportion_octagon" class="proportion">

            <label for="cb3"><i class="toggle"></i></label>

        </td>
        <td>
            <input type="checkbox" name="octagon_c" id="octagon_c" class="userchoice">

        </td>
    </tr>
    <tr>
        <td>nonagon</td>
        <td>
            <input type="checkbox" name="nonagon" id="nonagon" class="choice">
            <input type="text" name="proportion_nonagon" id="proportion_nonagon" class="proportion">

            <label for="cb3"><i class="toggle"></i></label>

        </td>
        <td>
            <input type="checkbox" name="nonagon_c" id="nonagon_c" class="userchoice">

        </td>
    </tr>

    <tr>
        <td>decagon</td>
        <td>
            <input type="checkbox" name="decagon" id="decagon" class="choice">
            <input type="text" name="proportion_decagon" id="proportion_decagon" class="proportion">

            <label for="cb3"><i class="toggle"></i></label>

        </td>
        <td>
            <input type="checkbox" name="decagon_c" id="decagon_c" class="userchoice">

        </td>
    </tr>
    <br>


</table>
<p></p>

<tr>
    <th>Degree tilted possible value</th>
    <td>
        <input style="width: 5%" class="degree" type="text" name="degree" id="degree1" placeholder="">
        <input style="width: 5%" class="degree" type="text" name="degree" id="degree2" placeholder="">
        <input style="width: 5%" class="degree" type="text" name="degree" id="degree3" placeholder="">

    </td>

</tr>
<p></p>
<tr>
    <th>Roundtime(s)</th>
    <td>
        <input type="text" name="roundtime" id="roundtime" placeholder="">

    </td>

</tr>
<p></p>

<button id="submit">Submit</button>
<br>
<br>
<br>
<button id="delete">Clean Data</button>

<div>
    <p>Settings Now</p>
    <p id="now_userchoices">user choices:</p>
    <p id="now_delta">Delta:</p>
    <p id="now_proportion">proportions of shapes:</p>
    <p id="now_degree">degree tilted possible value:</p>
    <p id="now_roundtime">roundtime:</p>



</div>

<script>
    var data = (document.querySelector('#data')).innerHTML;
    var start = data.indexOf('data');
    var data1 = JSON.parse((data.slice(start+7,-14)));

    data1.userchoices.forEach(x=>{
        document.querySelector('#now_userchoices').innerHTML+=' '+x.slice(0,-2);
    })

   // data1.proportion.forEach(x=>{
        document.querySelector('#now_proportion').innerHTML+=JSON.stringify(data1.proportion);
    //})
    document.querySelector('#now_degree').innerHTML+=data1.degree;
    document.querySelector('#now_roundtime').innerHTML+=data1.roundtime;
    document.querySelector('#now_delta').innerHTML+=data1.delta;

    function no_dup(uniqueArray) {
        return uniqueArray.filter(function(item, pos) {
            return uniqueArray.indexOf(item) == pos;
        })
    }
    let choicelist = document.querySelectorAll('.choice');
    let userchoicelist = document.querySelectorAll('.userchoice');
    document.querySelector('#delete').addEventListener('click',function () {
        let req= new XMLHttpRequest();
        req.open('POST', '/delete', true);
        req.setRequestHeader("Content-type", "application/x-www-form-urlencoded; charset=UTF-8");
        req.send("a=b");
    })
    document.querySelector('#submit').addEventListener('click',function (t) {
        let choicelist1 = [],shapes={}, proportion = {},proportion_sum = 0, userchoices = [];
        let degree_temp = document.querySelectorAll('.degree');
        let degree = [degree_temp[0].value,degree_temp[1].value,degree_temp[2].value];
        if(degree.indexOf('')!=-1){
            alert('Please fill all three possible degree tilts');
        }
        let roundtime = document.querySelector('#roundtime').value;
        let delta = document.querySelector('#delta').value;
        if(delta==""){
            alert('Fill the Delta Value')
        }
        t.preventDefault();
        choicelist.forEach(x=>{
            if(x.checked){
                choicelist1.push(x.id);
                proportion[x.id] = document.querySelector('#proportion_'+x.id).value;
                proportion_sum+=parseInt(document.querySelector('#proportion_'+x.id).value);
            }
        })
        userchoicelist.forEach(x=>{
            if(x.checked){
                userchoices.push(x.id);
            }
        })
        choicelist1 = no_dup(choicelist1);
        shapes['choicelist'] = choicelist1;
        shapes['proportion'] = proportion;
        shapes['degree'] = degree;
        shapes['roundtime'] = roundtime;
        shapes['userchoices'] = userchoices;
        shapes['delta'] = delta;


        console.log(shapes);

        if((roundtime!=undefined)&(degree!=undefined)&(proportion_sum==100)&(userchoices.length==2)){
            let req= new XMLHttpRequest();
            req.open('POST', '/admininfo', true);
            req.setRequestHeader("Content-type", "application/x-www-form-urlencoded; charset=UTF-8");
            req.send("shapes="+JSON.stringify(shapes));
        }else {
            alert("Fill all the fields; proportion sum should be 100, and with 2 user choices");
        }






    })

</script>